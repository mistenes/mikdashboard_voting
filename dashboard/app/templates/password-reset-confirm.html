<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MIK Dashboard – Új jelszó beállítása</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body
    class="auth-surface"
    data-auth-page="password-reset-confirm"
    data-form-visible="{{ 'true' if form_visible else 'false' }}"
    data-reset-token="{{ reset_token }}"
    data-summary-state="{{ summary_state }}"
    data-status-state="{{ status_state }}"
    data-requires-verify="{{ 'true' if requires_verify else 'false' }}"
    data-account-email="{{ account_email }}"
  >
    <main class="auth-layout">
      <section class="auth-hero">
        <div class="auth-brand">
          <span class="auth-badge">MIK Dashboard</span>
          <h1>Állíts be biztonságos jelszót!</h1>
          <p>
            A megadott token érvényességének ellenőrzése után add meg az új jelszót,
            majd ismételd meg a megerősítéshez.
          </p>
        </div>
        <ul class="auth-highlights">
          <li>
            <h2>Erős jelszó</h2>
            <p>Legalább 8 karakter, nagybetű és speciális karakter szükséges.</p>
          </li>
          <li>
            <h2>Egyszer használható link</h2>
            <p>A visszaállító hivatkozás csak rövid ideig és egyszer használható.</p>
          </li>
          <li>
            <h2>Azonnali hozzáférés</h2>
            <p>A sikeres mentés után az új jelszóval azonnal beléphetsz.</p>
          </li>
        </ul>
      </section>
      <section class="auth-panel" aria-labelledby="reset-confirm-title">
        <header class="auth-panel__header">
          <h1 id="reset-confirm-title">Új jelszó beállítása</h1>
          {% set summary_classes = ['auth-panel__lead'] %}
          {% if summary_state == 'success' %}
            {% set summary_classes = summary_classes + ['success'] %}
          {% elif summary_state == 'error' %}
            {% set summary_classes = summary_classes + ['error'] %}
          {% endif %}
          <p class="{{ ' '.join(summary_classes) }}" id="password-reset-summary">
            {{ (summary_message | safe) if summary_message else 'Ellenőrizzük a hivatkozást...' }}
          </p>
        </header>
        <form
          id="password-reset-confirm-form"
          class="auth-panel__form"
          novalidate
          method="post"
          {% if not form_visible %}hidden{% endif %}
        >
          <input
            type="hidden"
            id="password-reset-token"
            name="token"
            value="{{ reset_token }}"
          />
          <label class="auth-input" {% if new_password_error %}data-invalid="true"{% endif %}>
            <span class="auth-input__label">Új jelszó</span>
            <div class="auth-input__field">
              <input
                id="password-reset-new"
                name="password"
                type="password"
                placeholder="Új jelszó"
                autocomplete="new-password"
                required
                minlength="8"
              />
            </div>
            <span class="auth-input__error" id="password-reset-new-error"
              >{{ new_password_error }}</span
            >
          </label>
          <label class="auth-input" {% if confirm_password_error %}data-invalid="true"{% endif %}>
            <span class="auth-input__label">Új jelszó megerősítése</span>
            <div class="auth-input__field">
              <input
                id="password-reset-confirm"
                name="password_confirm"
                type="password"
                placeholder="Új jelszó ismét"
                autocomplete="new-password"
                required
                minlength="8"
              />
            </div>
            <span class="auth-input__error" id="password-reset-confirm-error"
              >{{ confirm_password_error }}</span
            >
          </label>
          <button type="submit" class="primary-btn auth-panel__submit">
            Új jelszó mentése
          </button>
        </form>
        {% set status_classes = ['auth-panel__status'] %}
        {% if status_state == 'success' %}
          {% set status_classes = status_classes + ['success'] %}
        {% elif status_state == 'error' %}
          {% set status_classes = status_classes + ['error'] %}
        {% endif %}
        <p
          id="password-reset-confirm-status"
          class="{{ ' '.join(status_classes) }}"
          role="status"
          aria-live="polite"
        >
          {{ status_message }}
        </p>
        <p class="auth-panel__footer">
          Vissza a <a href="/">bejelentkezési oldalra</a>.
        </p>
        <noscript>
          <p class="auth-panel__status error">
            A jelszó-visszaállításhoz engedélyezd a JavaScriptet, majd töltsd újra az oldalt.
          </p>
        </noscript>
      </section>
    </main>
    <script type="module" src="/static/password-reset-confirm.js"></script>
  </body>
</html>
